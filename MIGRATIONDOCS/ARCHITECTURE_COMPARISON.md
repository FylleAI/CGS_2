# ğŸ—ï¸ Confronto Architetture: CGS_2 vs Fylle Core Pulse

## ğŸ“Š Architettura Attuale (CGS_2)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         CGS_2 ARCHITECTURE                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          FRONTEND LAYER                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  onboarding-frontend/                                            â”‚
â”‚  â”œâ”€â”€ components/                                                 â”‚
â”‚  â”‚   â”œâ”€â”€ steps/          (Wizard steps)                         â”‚
â”‚  â”‚   â”œâ”€â”€ cards/          (CompanySnapshotCard, AnalyticsCard)   â”‚
â”‚  â”‚   â””â”€â”€ wizard/         (Wizard container)                     â”‚
â”‚  â”œâ”€â”€ renderers/          âœ… CORE - Renderer Registry Pattern    â”‚
â”‚  â”œâ”€â”€ hooks/              (useOnboarding)                        â”‚
â”‚  â””â”€â”€ store/              (Zustand state management)             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                           API LAYER                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  core/api/                                                       â”‚
â”‚  â”œâ”€â”€ main.py             âŒ INFRA - Basic FastAPI               â”‚
â”‚  â””â”€â”€ endpoints.py        ğŸ”„ ADAPT - API endpoints               â”‚
â”‚                                                                  â”‚
â”‚  onboarding/api/                                                 â”‚
â”‚  â”œâ”€â”€ main.py             âŒ INFRA - Basic FastAPI               â”‚
â”‚  â”œâ”€â”€ endpoints.py        âœ… CORE - Onboarding endpoints         â”‚
â”‚  â””â”€â”€ models.py           âœ… CORE - Request/Response models      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                       APPLICATION LAYER                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  core/application/                                               â”‚
â”‚  â”œâ”€â”€ use_cases/                                                  â”‚
â”‚  â”‚   â”œâ”€â”€ generate_content.py    âœ… CORE                         â”‚
â”‚  â”‚   â””â”€â”€ execute_workflow.py    âœ… CORE                         â”‚
â”‚  â””â”€â”€ dto/                        âœ… CORE                         â”‚
â”‚                                                                  â”‚
â”‚  onboarding/application/                                         â”‚
â”‚  â”œâ”€â”€ use_cases/                  âœ… CORE - Tutti i use cases    â”‚
â”‚  â”‚   â”œâ”€â”€ create_session.py                                      â”‚
â”‚  â”‚   â”œâ”€â”€ research_company.py    (Perplexity)                    â”‚
â”‚  â”‚   â”œâ”€â”€ synthesize_snapshot.py (Gemini)                        â”‚
â”‚  â”‚   â”œâ”€â”€ collect_answers.py                                     â”‚
â”‚  â”‚   â””â”€â”€ execute_onboarding.py                                  â”‚
â”‚  â””â”€â”€ builders/                   âœ… CORE                         â”‚
â”‚      â””â”€â”€ payload_builder.py     (CGS payload builder)           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         DOMAIN LAYER                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  core/domain/                                                    â”‚
â”‚  â”œâ”€â”€ entities/               âœ… CORE                             â”‚
â”‚  â”‚   â”œâ”€â”€ agent.py           (Agent with system prompts)         â”‚
â”‚  â”‚   â”œâ”€â”€ workflow.py        (Workflow definition)               â”‚
â”‚  â”‚   â”œâ”€â”€ document.py        (RAG documents)                     â”‚
â”‚  â”‚   â”œâ”€â”€ content.py         (Generated content)                 â”‚
â”‚  â”‚   â””â”€â”€ cost_event.py      (Cost tracking)                     â”‚
â”‚  â””â”€â”€ value_objects/          âœ… CORE                             â”‚
â”‚      â”œâ”€â”€ provider.py         (LLM provider enum)                â”‚
â”‚      â”œâ”€â”€ model_config.py     (Model configuration)              â”‚
â”‚      â””â”€â”€ tool_result.py      (Tool execution result)            â”‚
â”‚                                                                  â”‚
â”‚  onboarding/domain/                                              â”‚
â”‚  â”œâ”€â”€ models.py               âœ… CORE - CompanySnapshot          â”‚
â”‚  â”œâ”€â”€ cgs_contracts.py        âœ… CORE - CGS contracts            â”‚
â”‚  â””â”€â”€ content_types.py        âœ… CORE - Content types            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      INFRASTRUCTURE LAYER                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  core/infrastructure/                                            â”‚
â”‚  â”œâ”€â”€ workflows/              âœ… CORE                             â”‚
â”‚  â”‚   â”œâ”€â”€ registry.py        (Workflow registry pattern)         â”‚
â”‚  â”‚   â”œâ”€â”€ handlers/          (Workflow handlers)                 â”‚
â”‚  â”‚   â”‚   â”œâ”€â”€ onboarding_content_handler.py  ğŸ”¥ CRITICO         â”‚
â”‚  â”‚   â”‚   â”œâ”€â”€ linkedin_post_handler.py                           â”‚
â”‚  â”‚   â”‚   â”œâ”€â”€ blog_article_handler.py                            â”‚
â”‚  â”‚   â”‚   â””â”€â”€ analytics_dashboard_handler.py                     â”‚
â”‚  â”‚   â””â”€â”€ templates/         (YAML workflow templates)           â”‚
â”‚  â”œâ”€â”€ orchestration/          âœ… CORE                             â”‚
â”‚  â”‚   â”œâ”€â”€ prompt_builder.py  ğŸ”¥ CRITICO - Jinja2 prompts        â”‚
â”‚  â”‚   â””â”€â”€ workflow_orchestrator.py                               â”‚
â”‚  â”œâ”€â”€ tools/                  âœ… CORE                             â”‚
â”‚  â”‚   â”œâ”€â”€ rag_tool.py         ğŸ”¥ CRITICO - RAG semantic search  â”‚
â”‚  â”‚   â”œâ”€â”€ perplexity_tool.py                                     â”‚
â”‚  â”‚   â”œâ”€â”€ serper_tool.py                                         â”‚
â”‚  â”‚   â””â”€â”€ image_generation_tool.py                               â”‚
â”‚  â”œâ”€â”€ external_services/      âœ… CORE - LLM Adapters             â”‚
â”‚  â”‚   â”œâ”€â”€ openai_adapter.py                                      â”‚
â”‚  â”‚   â”œâ”€â”€ anthropic_adapter.py                                   â”‚
â”‚  â”‚   â”œâ”€â”€ gemini_adapter.py                                      â”‚
â”‚  â”‚   â””â”€â”€ deepseek_adapter.py                                    â”‚
â”‚  â”œâ”€â”€ factories/              âœ… CORE                             â”‚
â”‚  â”‚   â””â”€â”€ llm_provider_factory.py                                â”‚
â”‚  â”œâ”€â”€ database/               âŒ INFRA - Supabase                â”‚
â”‚  â”‚   â””â”€â”€ supabase_client.py (DA SOSTITUIRE)                     â”‚
â”‚  â””â”€â”€ config/                 ğŸ”„ ADAPT                            â”‚
â”‚      â””â”€â”€ settings.py                                             â”‚
â”‚                                                                  â”‚
â”‚  onboarding/infrastructure/                                      â”‚
â”‚  â”œâ”€â”€ adapters/               âœ… CORE                             â”‚
â”‚  â”‚   â”œâ”€â”€ perplexity_adapter.py                                  â”‚
â”‚  â”‚   â”œâ”€â”€ gemini_adapter.py                                      â”‚
â”‚  â”‚   â”œâ”€â”€ brevo_adapter.py                                       â”‚
â”‚  â”‚   â””â”€â”€ cgs_adapter.py                                         â”‚
â”‚  â””â”€â”€ repositories/           ğŸ”„ ADAPT                            â”‚
â”‚      â””â”€â”€ supabase_repository.py (DA ADATTARE)                   â”‚
â”‚                                                                  â”‚
â”‚  core/prompts/               âœ… CORE - IP Proprietario          â”‚
â”‚  â””â”€â”€ *.md                    (Prompt templates)                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        DATABASE LAYER                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Supabase PostgreSQL         âŒ INFRA - DA SOSTITUIRE           â”‚
â”‚  â”œâ”€â”€ pgvector                (Semantic search)                   â”‚
â”‚  â”œâ”€â”€ RLS policies            (Row-level security)                â”‚
â”‚  â””â”€â”€ Storage                 (File storage)                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ¯ Architettura Target (Fylle Core Pulse)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   FYLLE CORE PULSE ARCHITECTURE                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          FRONTEND LAYER                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  âœ… MANTENERE da CGS_2:                                          â”‚
â”‚  â”œâ”€â”€ components/steps/       (Wizard steps)                     â”‚
â”‚  â”œâ”€â”€ components/cards/       (CompanySnapshotCard, Analytics)   â”‚
â”‚  â”œâ”€â”€ renderers/              (Renderer Registry Pattern)        â”‚
â”‚  â”œâ”€â”€ hooks/useOnboarding     (Onboarding hook)                  â”‚
â”‚  â””â”€â”€ store/                  (Zustand state)                    â”‚
â”‚                                                                  â”‚
â”‚  ğŸ†• AGGIUNGERE:                                                  â”‚
â”‚  â””â”€â”€ Authentication          (Clerk.com integration)            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      API GATEWAY LAYER                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  app/main.py                 ğŸ†• Production-Ready FastAPI        â”‚
â”‚  â”œâ”€â”€ Middleware Stack:                                          â”‚
â”‚  â”‚   â”œâ”€â”€ ExceptionHandlerMiddleware    (FYL-35)                â”‚
â”‚  â”‚   â”œâ”€â”€ RequestIDMiddleware           (FYL-39)                â”‚
â”‚  â”‚   â”œâ”€â”€ AuthMiddleware                (API Key + JWT)         â”‚
â”‚  â”‚   â”œâ”€â”€ TenantContextMiddleware       (FYL-33)                â”‚
â”‚  â”‚   â””â”€â”€ AuditLoggingMiddleware        (FYL-36)                â”‚
â”‚  â”œâ”€â”€ Health Checks:          (FYL-40)                           â”‚
â”‚  â”‚   â”œâ”€â”€ /health                                                â”‚
â”‚  â”‚   â”œâ”€â”€ /health/ready                                          â”‚
â”‚  â”‚   â””â”€â”€ /health/live                                           â”‚
â”‚  â””â”€â”€ API Versioning:         /api/v1/                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         API ENDPOINTS                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  app/api/v1/                                                     â”‚
â”‚  â”œâ”€â”€ workflows.py            âœ… Da CGS_2                         â”‚
â”‚  â”œâ”€â”€ onboarding.py           âœ… Da CGS_2                         â”‚
â”‚  â”œâ”€â”€ agents.py               ğŸ†• Agent management                â”‚
â”‚  â”œâ”€â”€ knowledge.py            ğŸ†• RAG/Knowledge base              â”‚
â”‚  â”œâ”€â”€ admin/                  ğŸ†• Admin endpoints                 â”‚
â”‚  â”‚   â”œâ”€â”€ api_keys.py         (FYL-82)                           â”‚
â”‚  â”‚   â”œâ”€â”€ tenants.py          (FYL-44)                           â”‚
â”‚  â”‚   â””â”€â”€ users.py            (FYL-45)                           â”‚
â”‚  â””â”€â”€ auth/                   ğŸ†• Authentication                  â”‚
â”‚      â”œâ”€â”€ login.py            (FYL-6)                            â”‚
â”‚      â””â”€â”€ refresh.py                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                       APPLICATION LAYER                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  app/workflows/              âœ… Da CGS_2                         â”‚
â”‚  â”œâ”€â”€ use_cases/                                                  â”‚
â”‚  â”‚   â”œâ”€â”€ generate_content.py                                    â”‚
â”‚  â”‚   â””â”€â”€ execute_workflow.py                                    â”‚
â”‚  â”œâ”€â”€ handlers/                                                   â”‚
â”‚  â”‚   â”œâ”€â”€ onboarding_handler.py    ğŸ”¥ CRITICO                   â”‚
â”‚  â”‚   â”œâ”€â”€ linkedin_handler.py                                    â”‚
â”‚  â”‚   â”œâ”€â”€ blog_handler.py                                        â”‚
â”‚  â”‚   â””â”€â”€ analytics_handler.py                                   â”‚
â”‚  â””â”€â”€ templates/              (YAML workflows)                   â”‚
â”‚                                                                  â”‚
â”‚  app/onboarding/             âœ… Da CGS_2                         â”‚
â”‚  â”œâ”€â”€ use_cases/              (Tutti i use cases)                â”‚
â”‚  â”œâ”€â”€ builders/               (Payload builder)                  â”‚
â”‚  â””â”€â”€ adapters/               (Perplexity, Gemini, Brevo, CGS)   â”‚
â”‚                                                                  â”‚
â”‚  app/agents/                 âœ… Da CGS_2                         â”‚
â”‚  â”œâ”€â”€ entities/agent.py                                          â”‚
â”‚  â””â”€â”€ executor.py                                                â”‚
â”‚                                                                  â”‚
â”‚  app/tools/                  âœ… Da CGS_2                         â”‚
â”‚  â”œâ”€â”€ rag_tool.py             ğŸ”¥ CRITICO                         â”‚
â”‚  â”œâ”€â”€ perplexity_tool.py                                         â”‚
â”‚  â”œâ”€â”€ serper_tool.py                                             â”‚
â”‚  â””â”€â”€ image_generation_tool.py                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         DOMAIN LAYER                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  âœ… MANTENERE TUTTO da CGS_2:                                    â”‚
â”‚  â”œâ”€â”€ entities/               (Agent, Workflow, Document, etc.)  â”‚
â”‚  â”œâ”€â”€ value_objects/          (Provider, ModelConfig, etc.)      â”‚
â”‚  â””â”€â”€ onboarding/models.py    (CompanySnapshot)                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      INFRASTRUCTURE LAYER                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  app/llm/                    âœ… Da CGS_2                         â”‚
â”‚  â”œâ”€â”€ adapters/               (OpenAI, Anthropic, Gemini, etc.)  â”‚
â”‚  â””â”€â”€ factories/              (Provider factory)                 â”‚
â”‚                                                                  â”‚
â”‚  app/prompts/                âœ… Da CGS_2 - IP Proprietario      â”‚
â”‚  â”œâ”€â”€ prompt_builder.py       ğŸ”¥ CRITICO - Jinja2               â”‚
â”‚  â””â”€â”€ templates/*.md          (Prompt templates)                 â”‚
â”‚                                                                  â”‚
â”‚  app/core/                   ğŸ†• Nuova Infrastruttura            â”‚
â”‚  â”œâ”€â”€ database.py             (DatabaseManager + asyncpg)        â”‚
â”‚  â”œâ”€â”€ config.py               (Pydantic Settings)                â”‚
â”‚  â”œâ”€â”€ security.py             (API Key + JWT)                    â”‚
â”‚  â”œâ”€â”€ tenant_context.py       (Multi-tenancy)                    â”‚
â”‚  â””â”€â”€ audit_logger.py         (Audit logging)                    â”‚
â”‚                                                                  â”‚
â”‚  app/exceptions.py           ğŸ†• Exception Hierarchy (FYL-35)    â”‚
â”‚  app/utils/                  ğŸ†• Utilities                       â”‚
â”‚  â”œâ”€â”€ retry.py                (Retry logic - FYL-76)             â”‚
â”‚  â””â”€â”€ circuit_breaker.py      (Circuit breaker - FYL-77)         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        DATABASE LAYER                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Neon PostgreSQL             ğŸ†• Production Database             â”‚
â”‚  â”œâ”€â”€ pgvector + HNSW         (Faster semantic search)           â”‚
â”‚  â”œâ”€â”€ Connection pooling      (asyncpg)                          â”‚
â”‚  â”œâ”€â”€ Row-Level Security      (Multi-tenant isolation)           â”‚
â”‚  â””â”€â”€ Database branches       (main, staging, dev)               â”‚
â”‚                                                                  â”‚
â”‚  AWS S3                      ğŸ†• File Storage                    â”‚
â”‚  â””â”€â”€ Document storage        (Replace Supabase Storage)         â”‚
â”‚                                                                  â”‚
â”‚  Redis                       ğŸ†• Caching & Jobs                  â”‚
â”‚  â”œâ”€â”€ Config caching                                             â”‚
â”‚  â”œâ”€â”€ Rate limiting                                              â”‚
â”‚  â””â”€â”€ Job queue (Celery)                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“Š Confronto Componenti

| Componente | CGS_2 | Fylle Core Pulse | Azione |
|------------|-------|------------------|--------|
| **Frontend** | React + Vite | React + Vite | âœ… MANTENERE |
| **Renderer Registry** | âœ… Presente | âœ… Mantenere | âœ… MANTENERE |
| **API Framework** | FastAPI (basic) | FastAPI (production) | ğŸ”„ UPGRADE |
| **Authentication** | âŒ Nessuno | API Key + JWT | ğŸ†• AGGIUNGERE |
| **Multi-tenancy** | âŒ Nessuno | Tenant Context | ğŸ†• AGGIUNGERE |
| **Database** | Supabase | Neon PostgreSQL | ğŸ”„ MIGRARE |
| **Storage** | Supabase Storage | AWS S3 | ğŸ”„ MIGRARE |
| **Workflow Engine** | âœ… Template-based | âœ… Mantenere | âœ… MANTENERE |
| **Agent System** | âœ… Multi-agent | âœ… Mantenere | âœ… MANTENERE |
| **Prompt Builder** | âœ… Jinja2 | âœ… Mantenere | âœ… MANTENERE |
| **RAG Tool** | âœ… pgvector | âœ… Mantenere | âœ… MANTENERE |
| **LLM Adapters** | âœ… 4 providers | âœ… Mantenere | âœ… MANTENERE |
| **Onboarding** | âœ… Completo | âœ… Mantenere | âœ… MANTENERE |
| **Error Handling** | âŒ Basic | RFC 7807 | ğŸ†• AGGIUNGERE |
| **Logging** | âŒ Basic | Structured + Audit | ğŸ†• AGGIUNGERE |
| **Health Checks** | âŒ Nessuno | âœ… Completo | ğŸ†• AGGIUNGERE |
| **Background Jobs** | âŒ Nessuno | Celery + Redis | ğŸ†• AGGIUNGERE |
| **Monitoring** | âŒ Nessuno | Prometheus + Grafana | ğŸ†• AGGIUNGERE |

---

## ğŸ¯ Conclusione

### **CORE Fylle (60% del codice):**
- âœ… Workflow Engine + Handlers
- âœ… Agent System
- âœ… Prompt Builder + Templates
- âœ… Tool System (RAG, Perplexity, etc.)
- âœ… LLM Adapters (4 providers)
- âœ… Onboarding System completo
- âœ… Frontend completo (Renderer Registry)

### **Infrastruttura (40% del codice):**
- ğŸ”„ Database (Supabase â†’ Neon)
- ğŸ”„ Storage (Supabase â†’ S3)
- ğŸ†• Authentication (API Key + JWT)
- ğŸ†• Multi-tenancy (Tenant Context)
- ğŸ†• Error Handling (RFC 7807)
- ğŸ†• Monitoring (Logging, Health, Audit)
- ğŸ†• Background Jobs (Celery)

**La migrazione Ã¨ FATTIBILE e STRATEGICA: manteniamo il CORE di Fylle e sostituiamo solo l'infrastruttura con una production-ready.**


